# AI数据分析系统 - 增强版使用指南

## 🎯 系统概述

AI数据分析系统增强版是一个完整的数据分析到学术发表的一站式解决方案。系统集成了6大核心模块，实现了"更加智能化"的分析工作流。

### 🚀 核心特性

- **📄 模板优先**: 必须先上传分析模板，确保分析的规范性和一致性
- **🔗 智能合并**: 支持均值、求和、加权平均、因子得分等多种变量合并方法
- **🤖 AI分析**: 集成OpenAI和通义千问，提供智能化的数据分析和解读
- **📊 专业展示**: SPSSAU风格的结果展示，符合学术标准
- **📝 学术报告**: AI自动生成符合学术规范的研究报告
- **📚 文献管理**: 多平台文献检索和智能推荐系统

## 📋 完整工作流

### 步骤1: 📄 模板上传
- **目的**: 定义分析框架和变量结构
- **支持格式**: Excel (.xlsx, .xls), JSON
- **预设模板**: UTAUT2模型、聚类分析等
- **操作**: 上传模板文件或选择预设模板

### 步骤2: 📊 数据上传  
- **前提**: 必须先完成模板上传
- **支持格式**: CSV, Excel (.xlsx, .xls)
- **验证**: 自动检查数据列名与模板匹配性
- **展示**: 数据预览、样本统计、缺失值分析

### 步骤3: 🔗 变量合并
- **自动模式**: 应用模板中预定义的合并规则
- **手动模式**: 用户自定义合并规则
- **合并方法**:
  - 均值 (Mean)
  - 求和 (Sum) 
  - 加权平均 (Weighted Mean)
  - 因子得分 (Factor Score)
- **验证**: 反向计分、缺失值处理

### 步骤4: 🤖 AI分析
- **智能选择**: 基于模板自动选择分析方法
- **支持模型**:
  - K-means聚类分析
  - 探索性因子分析
  - UTAUT2技术接受模型
  - 结构方程模型
- **AI解读**: 智能生成分析结果解释

### 步骤5: 📈 结果展示
- **SPSSAU风格**: 专业的统计结果展示
- **包含内容**:
  - 描述性统计表格
  - 专业统计图表
  - AI智能解读
  - 交互式可视化
- **文献管理**: 集成参考文献检索和管理

### 步骤6: 📝 报告生成
- **AI驱动**: 自动生成完整学术报告
- **报告结构**:
  - 摘要 (Abstract)
  - 研究方法 (Methodology)
  - 结果分析 (Results)
  - 讨论与结论 (Discussion)
- **导出格式**: Word文档(.docx)
- **在线预览**: 支持在线查看和编辑

## 🛠️ 快速启动

### 方法1: 使用启动器（推荐）
```bash
python start_enhanced.py
```

启动器会自动：
- 检查Python版本和依赖
- 自动安装缺失的包
- 验证文件完整性
- 创建必要目录
- 启动应用

### 方法2: 直接启动
```bash
streamlit run enhanced_app.py
```

### 方法3: 指定端口
```bash
streamlit run enhanced_app.py --server.port=8502
```

## 📦 依赖要求

### Python版本
- Python 3.8+ （推荐3.9+）

### 核心依赖
```
streamlit>=1.28.0
pandas>=1.5.0
numpy>=1.24.0
plotly>=5.15.0
scikit-learn>=1.3.0
openai>=1.0.0
python-docx>=0.8.11
requests>=2.31.0
```

### 安装命令
```bash
pip install -r requirements.txt
```

## 🔑 API配置

### OpenAI配置
1. **环境变量方式**（推荐）:
   ```bash
   export OPENAI_API_KEY="your-api-key-here"
   ```

2. **应用内配置**: 在侧边栏的"API配置"中输入

### 通义千问配置
- 应用内配置Dashscope API密钥
- 获取地址: https://dashscope.console.aliyun.com/

## 📁 目录结构

```
AI/
├── enhanced_app.py              # 主应用文件
├── start_enhanced.py            # 启动器
├── requirements.txt             # 依赖列表
├── README_ENHANCED.md           # 本文档
├── src/                         # 源代码模块
│   ├── template_management/     # 模板管理
│   ├── data_processing/         # 数据处理
│   ├── ai_analysis/            # AI分析引擎
│   ├── results_display/        # 结果展示
│   ├── report_generation/      # 报告生成
│   └── literature/             # 文献管理
├── temp/                       # 临时文件
│   ├── figures/               # 图表缓存
│   ├── reports/               # 报告缓存
│   └── exports/               # 导出文件
└── data/                       # 数据目录
    ├── templates/              # 模板存储
    └── uploads/                # 上传文件
```

## 🎨 功能详解

### 模板管理系统
- **预设模板**: UTAUT2、聚类分析等研究模板
- **自定义模板**: 支持Excel和JSON格式
- **模板验证**: 自动检查模板格式和完整性
- **模板存储**: 支持保存和重用自定义模板

### 变量合并工具
- **反向计分**: 自动处理反向题目
- **缺失值处理**: 多种缺失值处理策略
- **合并验证**: 实时验证合并结果
- **预览功能**: 合并前后对比预览

### AI分析引擎
- **模型库**: 内置多种统计和机器学习模型
- **智能参数**: AI自动调优模型参数
- **结果解读**: 智能生成分析结果解释
- **假设检验**: 自动进行统计假设检验

### 专业结果展示
- **SPSSAU风格**: 完全仿照SPSSAU的专业界面
- **交互图表**: Plotly驱动的交互式可视化
- **统计表格**: 符合APA格式的专业表格
- **导出功能**: 支持多种格式导出

### 学术报告生成
- **AI写作**: 基于分析结果AI生成学术内容
- **格式规范**: 符合学术期刊投稿要求
- **参考文献**: 自动整合文献引用
- **版本管理**: 支持多版本报告管理

### 文献管理系统
- **多平台检索**: Google Scholar、PubMed、CNKI等
- **AI推荐**: 智能推荐相关文献
- **格式化**: 支持APA、IEEE、国标等多种格式
- **导出引用**: 一键导出参考文献列表

## 🔧 高级配置

### 自定义模板创建
1. 使用Excel创建模板:
   ```
   变量名    变量标签    数据类型    是否必需
   Q1        性别       类别        是
   Q2_1      有用性1    数值        是
   ```

2. 定义合并规则:
   ```json
   {
     "merge_rules": [
       {
         "target_variable": "PU",
         "source_variables": ["Q2_1", "Q2_2", "Q2_3"],
         "method": "mean"
       }
     ]
   }
   ```

### 自定义分析模型
```python
# 在model_selector.py中添加新模型
def custom_analysis(self, data, parameters):
    # 自定义分析逻辑
    pass
```

## 📊 使用示例

### 完整分析流程示例

1. **上传UTAUT2模板**
   - 选择预设的"UTAUT2技术接受模型"模板
   - 查看变量结构：PU(感知有用性)、PEU(感知易用性)等

2. **上传问卷数据**
   - 上传包含Q1_1到Q24等变量的CSV文件
   - 系统自动验证数据格式

3. **变量合并**
   - 自动应用模板的合并规则
   - PU = mean(Q1_1, Q1_2, Q1_3, Q1_4)
   - PEOU = mean(Q2_1, Q2_2, Q2_3, Q2_4)

4. **UTAUT2分析**
   - AI自动执行结构方程模型分析
   - 生成路径系数、拟合指标等结果

5. **专业展示**
   - SPSSAU风格的结果表格
   - 路径分析图、相关矩阵等可视化

6. **学术报告**
   - AI生成包含研究背景、方法、结果的完整报告
   - 自动整合参考文献

## ⚠️ 注意事项

### 数据要求
- 数据格式必须与模板匹配
- 建议样本量不少于200个
- 缺失值比例不超过5%

### 模板设计
- 变量命名要规范一致
- 合并规则要逻辑清晰
- 分析类型要准确指定

### API使用
- 注意API调用频率限制
- 确保网络连接稳定
- 及时更新API密钥

## 🐛 常见问题

### Q: 模块导入失败怎么办？
A: 使用启动器自动检查和安装依赖：`python start_enhanced.py`

### Q: 数据上传后提示格式错误？
A: 检查数据列名是否与模板变量名完全匹配，注意大小写和特殊字符

### Q: AI分析没有结果？
A: 检查API密钥配置，确保网络连接正常，查看控制台错误信息

### Q: 报告生成失败？
A: 确保完成了前面所有步骤，检查临时目录的写权限

### Q: 图表显示异常？
A: 刷新页面重新加载，检查Plotly版本是否兼容

## 🔄 更新日志

### v2.0 - 增强版 (当前版本)
- ✅ 集成6大核心模块
- ✅ 实现模板优先工作流
- ✅ 添加AI驱动的分析和报告
- ✅ 完善文献管理系统
- ✅ 优化用户界面和体验

### v1.0 - 基础版
- ✅ 基本数据分析功能
- ✅ 简单可视化
- ✅ OpenAI集成

## 📞 技术支持

如有问题或建议，请：
1. 查看本文档的常见问题部分
2. 检查控制台错误信息
3. 确保依赖和配置正确
4. 联系技术支持团队

---

🤖 **AI数据分析系统 v2.0** - 让数据分析更智能，让学术写作更高效！